@echo off
chcp 65001 > nul
title 데이터 제출 시스템 실행
color 0B
cls

echo.
echo ╔══════════════════════════════════════════════════════════════╗
echo ║                                                              ║
echo ║  ██████╗  █████╗ ████████╗ █████╗     ███████╗██╗   ██╗███████╗████████╗███████╗███╗   ███╗ ║
echo ║  ██╔══██╗██╔══██╗╚══██╔══╝██╔══██╗    ██╔════╝╚██╗ ██╔╝██╔════╝╚══██╔══╝██╔════╝████╗ ████║ ║
echo ║  ██║  ██║███████║   ██║   ███████║    ███████╗ ╚████╔╝ ███████╗   ██║   █████╗  ██╔████╔██║ ║
echo ║  ██║  ██║██╔══██║   ██║   ██╔══██║    ╚════██║  ╚██╔╝  ╚════██║   ██║   ██╔══╝  ██║╚██╔╝██║ ║
echo ║  ██████╔╝██║  ██║   ██║   ██║  ██║    ███████║   ██║   ███████║   ██║   ███████╗██║ ╚═╝ ██║ ║
echo ║  ╚═════╝ ╚═╝  ╚═╝   ╚═╝   ╚═╝  ╚═╝    ╚══════╝   ╚═╝   ╚══════╝   ╚═╝   ╚══════╝╚═╝     ╚═╝ ║
echo ║                                                              ║
echo ║                    📁 데이터 제출 관리 시스템                    ║
echo ║                       🚀 서버 시작 중...                      ║
echo ║                                                              ║
echo ╚══════════════════════════════════════════════════════════════╝
echo.

cd /d "%~dp0"

echo [1/3] 환경 확인 중...
if not exist "node_modules" (
    echo ❌ 먼저 "설치.bat"를 실행하세요.
    echo.
    echo 🔧 설치.bat를 지금 실행하시겠습니까? (Y/N)
    set /p install_now=선택: 
    if /i "%install_now%"=="Y" (
        call 설치.bat
        exit /b 0
    ) else (
        pause
        exit /b 1
    )
)
echo ✅ 환경 확인 완료

echo [2/3] 포트 확인 중...
netstat -an | findstr ":5000.*LISTENING" >nul 2>&1
if %errorlevel% equ 0 (
    echo ⚠️  포트 5000이 이미 사용 중입니다.
    echo 💡 기존 서버를 종료하고 새로 시작합니다.
    taskkill /f /im node.exe >nul 2>&1
    timeout /t 2 /nobreak >nul
)
echo ✅ 포트 준비 완료

echo [3/3] 서버 시작 중...
echo.

cls
color 0E
echo.
echo ╔══════════════════════════════════════════════════════════════╗
echo ║                                                              ║
echo ║                    🎉 서버 시작 완료! 🎉                      ║
echo ║                                                              ║
echo ║  📍 서버 주소: http://localhost:5000                          ║
echo ║                                                              ║
echo ║  🔗 아래 링크를 클릭하여 브라우저에서 열기:                     ║
echo ║                                                              ║
echo ╚══════════════════════════════════════════════════════════════╝
echo.
echo    👆 클릭하여 웹사이트 열기 👆
echo    http://localhost:5000
echo.
echo ╔══════════════════════════════════════════════════════════════╗
echo ║                        📋 사용 안내                           ║
echo ║                                                              ║
echo ║  🔐 관리자 로그인:                                             ║
echo ║     • 우상단 "관리자" 버튼 클릭                                ║
echo ║     • 비밀번호: 0000                                          ║
echo ║                                                              ║
echo ║  🚀 주요 기능:                                                ║
echo ║     • 이벤트 생성 및 관리                                      ║
echo ║     • 파일 업로드 및 제출                                      ║
echo ║     • 제출 현황 대시보드                                       ║
echo ║     • 실시간 통계 확인                                         ║
echo ║                                                              ║
echo ║  🛑 서버 중지: 이 창에서 Ctrl+C                               ║
echo ║                                                              ║
echo ╚══════════════════════════════════════════════════════════════╝
echo.

REM 3초 후 브라우저 자동 실행
echo 🔄 3초 후 브라우저가 자동으로 열립니다...
start /b timeout /t 3 /nobreak > nul && start http://localhost:5000

echo.
echo ⚡ 서버 시작 중... 잠시만 기다려주세요.
echo.

npm run dev

echo.
echo ╔══════════════════════════════════════════════════════════════╗
echo ║                      서버가 종료되었습니다                      ║
echo ║                                                              ║
echo ║  🔄 다시 시작하려면: 실행.bat 실행                             ║
echo ║  🔧 문제가 있다면: 설치.bat 다시 실행                          ║
echo ║                                                              ║
echo ╚══════════════════════════════════════════════════════════════╝
echo.
pause 